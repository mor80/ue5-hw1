# Cabbage Protocol: Collector

## 1. Автор

**ФИО:** *Гювенч Эмрэ Халитович*

---

## 2. Подробное текстовое описание алгоритмов генерации / формирования комнат и их содержимого

### Общая идея уровней

Игровой процесс построен как последовательность арен-комнат, между которыми игрок перемещается через порталы.
Каждая арена представляет собой отдельный Blueprint-класс комнаты, унаследованный от общего базового класса `BP_BaseRoom`.

В текущей версии проекта комнаты **расставлены вручную на уровне**, а не создаются процедурно, но логика их работы и переходов между ними построена так, как если бы они были элементами пула арен:

* есть стартовая комната;
* несколько промежуточных комнат разной сложности;
* финальная комната с боссом.

### Структура комнат (BP_BaseRoom и наследники)

Базовый класс комнаты `BP_BaseRoom` отвечает за:

* хранение ссылок на:

  * массив врагов комнаты (`Enemies`);
  * массив порталов, которые ведут из комнаты далее (`Portals`);
* хранение счётчика живых врагов (`EnemiesLeft`);
* логику активации порталов после зачистки комнаты.

Алгоритм работы комнаты:

1. **Инициализация (BeginPlay):**

   * `EnemiesLeft` инициализируется:

     * либо как `Length(Enemies)`, если массив заполнен в редакторе;
     * либо увеличивается врагами, которые сами регистрируются в комнате в своём `BeginPlay`.
   * Все порталы из массива `Portals` скрываются:

     * `Set Actor Hidden In Game(true)`;
     * `Set Actor Enable Collision(false)`.

2. **Учёт смерти врагов:**

   * Каждый враг хранит ссылку на свою комнату (`Room : BP_BaseRoom`).
   * При смерти враг вызывает у комнаты событие `EnemyDied`.
   * `EnemyDied` уменьшает `EnemiesLeft` на 1.
   * Когда `EnemiesLeft <= 0`, вызывается `ActivatePortals`.

3. **Активация порталов:**

   * В `ActivatePortals` комната проходит по массиву `Portals` и:

     * делает порталы видимыми;
     * включает коллизию и возможность входа в них;
     * при необходимости запускает визуальные/звуковые эффекты (Niagara, глоу и т.п.).

Таким образом, содержимое комнаты (враги, порталы, ловушки) задаётся в редакторе, а логика их “жизни” и перехода к следующей арене реализована в общем базовом классе.

### Содержимое комнат

В типичной комнате находятся:

* один или несколько обычных врагов-дронов;
* при необходимости — **босс** (в финальной комнате);
* **порталы**, ведущие:

  * в лёгкую комнату;
  * в сложную комнату;
* **пикапы патронов**, которые дропаются с врагов;
* дополнительные элементы окружения и ловушки (например, **лазерная ловушка на Niagara**, убивающая игрока при пересечении).

Комнаты разного типа отличаются:

* количеством врагов;
* их расположением;
* наличием/отсутствием ловушек (лазер);
* количеством укрытий и пикапов патронов.

---

## 3. Описание принципа изменения уровня сложности в игре

В игре реализован **ветвящийся путь прохождения** через систему порталов.

### Выбор сложности через порталы

После зачистки очередной арены комната активирует два (или более) портала:

* портал **лёгкой** сложности;
* портал **сложной** сложности.

Игрок **сам выбирает**, в какую комнату перейти дальше:

* выбор лёгкого портала ведёт в комнату с:

  * меньшим количеством врагов;
  * более простым окружением;
  * меньшим риском (меньше ловушек, больше боезапаса).
* выбор сложного портала ведёт в комнату с:

  * большим числом врагов;
  * более агрессивным окружением (например, наличие убийственного лазера);
  * меньшим количеством укрытий/ресурсов.

Таким образом, сложность **настраивается игроком динамически** через путь, который он выбирает.

### Параметры, влияющие на сложность

Сложность комнаты регулируется за счёт:

* **Количество врагов** — больше врагов и более плотные волны дают более высокий уровень сложности.
* **Позиционирование врагов** — фланговые позиции, высоты, расстояния до игрока.
* **Наличие ловушек**:

  * Niagara-лазер, который убивает при пересечении, добавляет дополнительный риск и требует аккуратного позиционирования.
* **Ресурсы**:

  * количество дропов патронов с врагов;
  * расположение боеприпасов и потенциальных источников пополнения (автоматы, если используются).

Финальная арена с боссом по определению является **самой сложной**, т.к. объединяет:

* повышенный запас здоровья босса;
* особое поведение;
* возможное совмещение с окружением и ловушками.

---

## 4. Описание всех значимых реализованных сверх условия дополнений

Ниже описаны механики, которые выходят за рамки базового задания или развивают его.

### 4.1. Система боеприпасов и их дропа

Реализована **расширенная система патронов**, включающая:

* разделение боезапаса на:

  * патроны в магазине;
  * общий запас (резерв);
* UI-отображение:

  * счётчик патронов в магазине и в резерве;
  * динамический материал и полоска, меняющаяся в зависимости от количества патронов;
* выпадающие **пикапы патронов с врагов**:

  * при смерти врага спавнится актор патронов;
  * пикап падает вниз и останавливается, чтобы не кататься по полу;
  * при подборе увеличивает запас боеприпасов игрока.

### 4.2. Выбор и смена оружия

Помимо базового Cabbage Blaster реализован **выбор разного оружия**:

* несколько видов оружия с разными характеристиками;
* переключение оружия (например, по клавишам или колесику мыши);
* для каждого оружия — своя логика расхода боеприпасов и перезарядки.

Это расширяет боёвку и даёт игроку больше тактических опций.

### 4.3. Анимация перезарядки

Реализована **анимация перезарядки оружия**:

* при нажатии на клавишу перезарядки:

  * подсчитывается, сколько патронов можно переложить из резерва в магазин;
  * запускается анимация перезарядки;
  * после завершения анимации обновляются значения патронов и UI.

Анимация делает механику стрельбы визуально и тактильно более насыщенной.

### 4.4. Лазер на Niagara, который убивает

Создана **лазерная ловушка на Niagara**:

* визуально — луч между двумя точками (начало/конец), рендерится Niagara-системой;
* логика:

  * вдоль луча рассчитывается коллизионный Box, растянутый от начала до конца луча;
  * при пересечении игроком этого Box’а:

    * вызывается логика смерти / нанесения большого урона;
    * уровень перезапускается (полный рестарт карты);
* лазер можно использовать как элемент увеличения сложности в “хардовых” комнатах.

### 4.5. Порталы и логика появления

Сами порталы реализованы как отдельные Blueprint-акторы:

* изначально скрыты и без коллизии;
* активируются комнатой (`ActivatePortal`) только после убийства всех врагов;
* при входе в портал:

  * игрок переносится в следующую комнату соответствующей сложности;
  * возможно воспроизведение эффектов (визуал/звук).

В совокупности с базовым `BP_BaseRoom` это создаёт законченную систему прогрессии по аренным комнатам.

### 4.6. Камера шейк

Добавлен **эффект тряски камеры** (Camera Shake):

* при ходьбе / беге камера получает кратковременный shake;
* усиливает ощущение отдачи и “веса” действий;
* помогает передать интенсивность боя.


